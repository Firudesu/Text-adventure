<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Game Design Review System</title>
    <link rel="stylesheet" href="css/main.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
</head>
<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-spinner"></div>
        <p>Loading Game Design Review System...</p>
    </div>

    <!-- Auth Modal -->
    <div id="auth-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2 id="auth-title">Sign In</h2>
                <button class="close-btn" onclick="closeAuthModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="auth-form">
                    <div class="form-group" id="username-group" style="display: none;">
                        <label for="username">Username</label>
                        <input type="text" id="username" name="username" required>
                    </div>
                    <div class="form-group">
                        <label for="email">Email</label>
                        <input type="email" id="email" name="email" required>
                    </div>
                    <div class="form-group">
                        <label for="password">Password</label>
                        <input type="password" id="password" name="password" required>
                    </div>
                    <div class="form-group" id="role-group" style="display: none;">
                        <label for="role">Role</label>
                        <select id="role" name="role">
                            <option value="reviewer">Reviewer</option>
                            <option value="developer">Developer</option>
                            <option value="designer">Designer</option>
                        </select>
                    </div>
                    <button type="submit" class="btn btn-primary" id="auth-submit">Sign In</button>
                </form>
                <p class="auth-switch">
                    <span id="auth-switch-text">Don't have an account?</span>
                    <a href="#" id="auth-switch-link" onclick="toggleAuthMode()">Sign Up</a>
                </p>
            </div>
        </div>
    </div>

    <!-- Main Application -->
    <div id="app" class="hidden">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="sidebar-header">
                <h1><i class="fas fa-gamepad"></i> Game Review</h1>
            </div>
            <nav class="sidebar-nav">
                <ul>
                    <li><a href="#" class="nav-link active" data-page="dashboard"><i class="fas fa-home"></i> Dashboard</a></li>
                    <li><a href="#" class="nav-link" data-page="projects"><i class="fas fa-folder"></i> Projects</a></li>
                    <li><a href="#" class="nav-link" data-page="tasks"><i class="fas fa-tasks"></i> Tasks</a></li>
                    <li><a href="#" class="nav-link" data-page="media"><i class="fas fa-images"></i> Media</a></li>
                    <li><a href="#" class="nav-link" data-page="team"><i class="fas fa-users"></i> Team</a></li>
                </ul>
            </nav>
            <div class="sidebar-footer">
                <div class="user-info">
                    <div class="user-avatar">
                        <i class="fas fa-user"></i>
                    </div>
                    <div class="user-details">
                        <span class="username" id="current-username">Loading...</span>
                        <span class="user-role" id="current-role">...</span>
                    </div>
                </div>
                <button class="btn btn-ghost" onclick="logout()">
                    <i class="fas fa-sign-out-alt"></i> Logout
                </button>
            </div>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Top Bar -->
            <header class="top-bar">
                <div class="top-bar-left">
                    <h2 id="page-title">Dashboard</h2>
                </div>
                <div class="top-bar-right">
                    <div class="search-box">
                        <i class="fas fa-search"></i>
                        <input type="text" placeholder="Search tasks, projects..." id="global-search">
                    </div>
                    <button class="btn btn-primary" onclick="showCreateTaskModal()">
                        <i class="fas fa-plus"></i> New Task
                    </button>
                    <div class="notifications">
                        <button class="notification-btn">
                            <i class="fas fa-bell"></i>
                            <span class="notification-badge">3</span>
                        </button>
                    </div>
                </div>
            </header>

            <!-- Page Content -->
            <div class="page-content">
                <!-- Dashboard Page -->
                <div id="dashboard-page" class="page active">
                    <div class="dashboard-grid">
                        <div class="stats-cards">
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-tasks"></i></div>
                                <div class="stat-content">
                                    <h3 id="total-tasks">0</h3>
                                    <p>Total Tasks</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-clock"></i></div>
                                <div class="stat-content">
                                    <h3 id="pending-tasks">0</h3>
                                    <p>Pending</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-check"></i></div>
                                <div class="stat-content">
                                    <h3 id="completed-tasks">0</h3>
                                    <p>Completed</p>
                                </div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-icon"><i class="fas fa-exclamation-triangle"></i></div>
                                <div class="stat-content">
                                    <h3 id="critical-tasks">0</h3>
                                    <p>Critical</p>
                                </div>
                            </div>
                        </div>

                        <div class="dashboard-content">
                            <div class="recent-tasks">
                                <h3>Recent Tasks</h3>
                                <div id="recent-tasks-list" class="task-list">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                            
                            <div class="project-overview">
                                <h3>Active Projects</h3>
                                <div id="active-projects-list" class="project-list">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Tasks Page -->
                <div id="tasks-page" class="page">
                    <div class="tasks-header">
                        <div class="task-filters">
                            <select id="status-filter">
                                <option value="">All Status</option>
                                <option value="open">Open</option>
                                <option value="in-progress">In Progress</option>
                                <option value="needs-review">Needs Review</option>
                                <option value="resolved">Resolved</option>
                                <option value="closed">Closed</option>
                            </select>
                            <select id="priority-filter">
                                <option value="">All Priorities</option>
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                            <select id="assignee-filter">
                                <option value="">All Assignees</option>
                                <!-- Dynamic options -->
                            </select>
                        </div>
                        <div class="task-views">
                            <button class="view-btn active" data-view="list">
                                <i class="fas fa-list"></i> List
                            </button>
                            <button class="view-btn" data-view="kanban">
                                <i class="fas fa-columns"></i> Kanban
                            </button>
                        </div>
                    </div>

                    <!-- Task List View -->
                    <div id="task-list-view" class="task-view active">
                        <div class="task-table-header">
                            <div class="task-cell task-title">Title</div>
                            <div class="task-cell task-status">Status</div>
                            <div class="task-cell task-priority">Priority</div>
                            <div class="task-cell task-assignee">Assignee</div>
                            <div class="task-cell task-created">Created</div>
                            <div class="task-cell task-actions">Actions</div>
                        </div>
                        <div id="task-table-body" class="task-table-body">
                            <!-- Dynamic content -->
                        </div>
                    </div>

                    <!-- Kanban View -->
                    <div id="kanban-view" class="task-view">
                        <div class="kanban-board">
                            <div class="kanban-column" data-status="open">
                                <div class="kanban-header">
                                    <h3>Open</h3>
                                    <span class="task-count">0</span>
                                </div>
                                <div class="kanban-tasks" id="kanban-open">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                            <div class="kanban-column" data-status="in-progress">
                                <div class="kanban-header">
                                    <h3>In Progress</h3>
                                    <span class="task-count">0</span>
                                </div>
                                <div class="kanban-tasks" id="kanban-in-progress">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                            <div class="kanban-column" data-status="needs-review">
                                <div class="kanban-header">
                                    <h3>Needs Review</h3>
                                    <span class="task-count">0</span>
                                </div>
                                <div class="kanban-tasks" id="kanban-needs-review">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                            <div class="kanban-column" data-status="resolved">
                                <div class="kanban-header">
                                    <h3>Resolved</h3>
                                    <span class="task-count">0</span>
                                </div>
                                <div class="kanban-tasks" id="kanban-resolved">
                                    <!-- Dynamic content -->
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Other pages will be added here -->
                <div id="projects-page" class="page">
                    <h3>Projects (Coming Soon)</h3>
                    <p>Project management features will be implemented here.</p>
                </div>

                <div id="media-page" class="page">
                    <h3>Media Gallery (Coming Soon)</h3>
                    <p>Media gallery with annotation tools will be implemented here.</p>
                </div>

                <div id="team-page" class="page">
                    <h3>Team Management (Coming Soon)</h3>
                    <p>Team management features will be implemented here.</p>
                </div>
            </div>
        </main>
    </div>

    <!-- Task Detail Modal -->
    <div id="task-modal" class="modal hidden">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="task-modal-title">Task Details</h2>
                <button class="close-btn" onclick="closeTaskModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="task-detail-layout">
                    <div class="task-main">
                        <div class="task-header">
                            <h3 id="task-detail-title">Loading...</h3>
                            <div class="task-meta">
                                <span class="task-status" id="task-detail-status">open</span>
                                <span class="task-priority" id="task-detail-priority">medium</span>
                            </div>
                        </div>
                        <div class="task-description">
                            <p id="task-detail-description">Loading...</p>
                        </div>
                        <div class="task-attachments">
                            <h4>Attachments</h4>
                            <div id="task-detail-attachments" class="attachment-grid">
                                <!-- Dynamic content -->
                            </div>
                            <div class="upload-area">
                                <input type="file" id="task-file-input" multiple accept="image/*,video/*" style="display: none;">
                                <button class="btn btn-outline" onclick="document.getElementById('task-file-input').click()">
                                    <i class="fas fa-upload"></i> Upload Files
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="task-sidebar">
                        <div class="task-info">
                            <div class="info-group">
                                <label>Assignee</label>
                                <select id="task-assignee-select">
                                    <option value="">Unassigned</option>
                                    <!-- Dynamic options -->
                                </select>
                            </div>
                            <div class="info-group">
                                <label>Status</label>
                                <select id="task-status-select">
                                    <option value="open">Open</option>
                                    <option value="in-progress">In Progress</option>
                                    <option value="needs-review">Needs Review</option>
                                    <option value="resolved">Resolved</option>
                                    <option value="closed">Closed</option>
                                </select>
                            </div>
                            <div class="info-group">
                                <label>Priority</label>
                                <select id="task-priority-select">
                                    <option value="low">Low</option>
                                    <option value="medium">Medium</option>
                                    <option value="high">High</option>
                                    <option value="critical">Critical</option>
                                </select>
                            </div>
                        </div>
                        <div class="task-timeline">
                            <h4>Timeline</h4>
                            <div id="task-timeline-list" class="timeline">
                                <!-- Dynamic content -->
                            </div>
                        </div>
                    </div>
                </div>
                <div class="task-comments">
                    <h4>Comments</h4>
                    <div id="task-comments-list" class="comments-list">
                        <!-- Dynamic content -->
                    </div>
                    <div class="comment-form">
                        <textarea id="new-comment" placeholder="Add a comment..."></textarea>
                        <button class="btn btn-primary" onclick="addComment()">
                            <i class="fas fa-paper-plane"></i> Post Comment
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Image Annotation Modal -->
    <div id="annotation-modal" class="modal hidden">
        <div class="modal-content fullscreen">
            <div class="modal-header">
                <h2>Image Annotation</h2>
                <div class="annotation-tools">
                    <button class="tool-btn active" data-tool="select"><i class="fas fa-mouse-pointer"></i></button>
                    <button class="tool-btn" data-tool="text"><i class="fas fa-font"></i></button>
                    <button class="tool-btn" data-tool="arrow"><i class="fas fa-long-arrow-alt-right"></i></button>
                    <button class="tool-btn" data-tool="rectangle"><i class="fas fa-square"></i></button>
                    <button class="tool-btn" data-tool="circle"><i class="fas fa-circle"></i></button>
                    <button class="tool-btn" data-tool="freehand"><i class="fas fa-pencil-alt"></i></button>
                    <div class="color-picker">
                        <input type="color" id="annotation-color" value="#ff0000">
                    </div>
                    <div class="stroke-width">
                        <input type="range" id="stroke-width" min="1" max="10" value="2">
                    </div>
                </div>
                <button class="close-btn" onclick="closeAnnotationModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="annotation-workspace">
                    <canvas id="annotation-canvas"></canvas>
                    <img id="annotation-image" alt="Image to annotate">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="clearAnnotations()">Clear All</button>
                <button class="btn btn-primary" onclick="saveAnnotations()">Save Annotations</button>
            </div>
        </div>
    </div>

    <!-- Create Task Modal -->
    <div id="create-task-modal" class="modal hidden">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create New Task</h2>
                <button class="close-btn" onclick="closeCreateTaskModal()">&times;</button>
            </div>
            <div class="modal-body">
                <form id="create-task-form">
                    <div class="form-group">
                        <label for="new-task-title">Title *</label>
                        <input type="text" id="new-task-title" required>
                    </div>
                    <div class="form-group">
                        <label for="new-task-description">Description</label>
                        <textarea id="new-task-description" rows="4"></textarea>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="new-task-priority">Priority</label>
                            <select id="new-task-priority">
                                <option value="low">Low</option>
                                <option value="medium" selected>Medium</option>
                                <option value="high">High</option>
                                <option value="critical">Critical</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="new-task-category">Category</label>
                            <select id="new-task-category">
                                <option value="bug">Bug</option>
                                <option value="feature">Feature</option>
                                <option value="improvement">Improvement</option>
                                <option value="design">Design</option>
                                <option value="performance">Performance</option>
                                <option value="accessibility">Accessibility</option>
                                <option value="other" selected>Other</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="new-task-assignee">Assignee</label>
                        <select id="new-task-assignee">
                            <option value="">Unassigned</option>
                            <!-- Dynamic options -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="new-task-tags">Tags (comma separated)</label>
                        <input type="text" id="new-task-tags" placeholder="ui, gameplay, level1">
                    </div>
                    <button type="submit" class="btn btn-primary">Create Task</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Toast Notifications -->
    <div id="toast-container" class="toast-container"></div>

    <!-- Scripts -->
    <script src="/socket.io/socket.io.js"></script>
    <script src="js/auth.js"></script>
    <script src="js/api.js"></script>
    <script src="js/ui.js"></script>
    <script src="js/tasks.js"></script>
    <script src="js/annotation.js"></script>
    <script src="js/app.js"></script>
</body>
</html>